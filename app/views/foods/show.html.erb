<!-- パンくずリスト -->
<% breadcrumb :food_show, @food %>

<div class="container my-5">

  <!-- タイトル -->
  <div class="text-center mb-5">
    <h1><%= I18n.t("food.show.title", food_name: @food.name) %></h1>
  </div>

  <!-- 食品詳細 -->
  <div class="show-food-form mb-5">
    <div class="row">
      <!-- 食品画像 -->
      <div class="col-md-6 mb-3">
        <div class="d-flex flex-column align-items-center">
          <%= image_tag(@food.food_image.present? ? @food.food_image.url : "image_ramen.png", class: "img-fluid show-food-image") %>
          <!-- お気に入り食品機能（8/23追加） -->
          <% if current_user %>
            <% if current_user.favorite?(@food) %>
              <%= button_to unfavorite_food_path(@food), method: :delete, remote: true, class: "btn btn-warning" do %>
                <i class="bi bi-bookmark-heart-fill"></i><%= I18n.t("food.show.unfavorite") %>
              <% end %>
            <% else %>
              <%= button_to favorite_food_path(@food), method: :post, remote: true, class: "btn btn-outline-warning" do %>
                <i class="bi bi-bookmark-heart"></i><%= I18n.t("food.show.favorite") %>
              <% end %>
            <% end %>
          <% end %>          
        </div>
      </div>
      <div class="col-md-6">
        <!-- 食品名 -->
        <h2 class="fw-bold text-primary mt-5 mb-0"><%= @food.name %></h2>
        <!-- 食品タグ -->
        <h5 class="fw-bold mt-3">
          <span class="badge rounded-pill bg-danger"><%= @food.food_category.name %></span>
        </h5>
        <!-- 辛さレベル -->
        <h6 class="fw-bold mt-4">
          <%=  I18n.t("activerecord.attributes.review.spice_level") %>
          <% @food.spice_level.times do %>
            <i class="bi bi-fire text-danger"></i>
          <% end %>
          <% (5 - @food.spice_level).times do %>
            <i class="bi bi-fire text-secondary"></i>
          <% end %>
        </h6>
        <!-- 希望小売価格 -->
        <h6 class="fw-bold">
          <%=  I18n.t("activerecord.attributes.food.price") %>
          <% if @food.price != 0 %>
            <%= number_to_currency(@food.price, unit: I18n.t("food.index.en"), format: "%n %u", precision: 0) %><%= I18n.t("food.index.in_price") %>
          <% else %>
            <%= I18n.t("food.index.open_price") %>
          <% end %>
        </h6>
        <hr class="border border-primary border-1">
        <!-- タイトル -->
        <p class="text-danger fw-bold mt-3"><%= @food.title %></p>
        <!-- 説明 -->
        <p class="fw-bold"><%= @food.body %></p>
        <!-- 出典 -->
        <p class="mb-5">出典：株式会社農心ジャパン</p>    
      </div>
    </div>
  </div>

  <!-- タイトル -->
  <div id="show-review-title" class="show-review-title mb-5">
    <h1><%= I18n.t("food.show.review", food_name: @food.name) %></h1>
    <% unless @reviews.present? %>
      <h5 class="text-center text-info pt-2">
        <%= I18n.t("food.show.no_review") %>
      </h5>
    <% end %>
    <!-- 投稿ボタン -->
    <div class="text-center mt-4">
      <%= link_to I18n.t("buttons.post"), new_food_review_path(@food), class:"btn btn-primary" %>
    </div>
  </div>

  <!-- レビュー一覧 -->
  <% if @reviews.present? %>
    <div class="show-review-form">
      <!-- ページネーション -->
      <div class="mt-4 me-4 text-end text-primary">
        <%= link_to I18n.t("views.pagination.new"), food_path(@food, sort: 'new', anchor: 'show-review-title'), class: "pe-2 text-decoration-none #{'text-decoration-underline' if @current_sort == 'new'}" %>
        <%= link_to I18n.t("views.pagination.old"), food_path(@food, sort: 'old', anchor: 'show-review-title'), class: "text-decoration-none #{'text-decoration-underline' if @current_sort == 'old'}" %>
      </div>

      <!-- レビュー一覧 -->
      <div class="row">
        <% @reviews.each do |review| %>
          <div class="col-12 mb-4">
            <!-- ユーザー名 -->
            <h5 class="fw-bold mt-2 mx-2 text-primary">
              <%= link_to review.user.name, user_path(review.user) %>
            </h5>
            <div class="show-review-flex">
              <!-- 辛さレベル -->
              <p class="fw-bold mt-0 mx-2 mb-0 p-0" style="display: inline-block;">
                <%=  I18n.t("activerecord.attributes.review.spice_level") %>
                <% review.spice_level.times do %>
                    <i class="bi bi-fire text-danger"></i>
                <% end %>
                <% (5 - review.spice_level).times do %>
                    <i class="bi bi-fire text-secondary"></i>
                <% end %>
              </p>
              <div class="show-review-icon mb-0 me-4 p-0">
                <% if current_user == review.user %>
                  <div class="btn-group me-2" role="group">
                    <!-- 編集タグ -->
                    <%= link_to edit_food_review_path(@food, review), class:"btn btn-outline-warning" do %>
                      <i class="bi bi-pencil-fill"></i>
                    <% end %>
                    <!-- 削除タグ -->
                    <%= link_to food_review_path(@food, review), class:"btn btn-outline-warning", data: { turbo_method: :delete, turbo_confirm: I18n.t("buttons.confirm") } do %>
                      <i class="bi bi-trash"></i></i>
                    <% end %>
                  </div>                 
                <% else %>
                  <!-- いいねタグ -->
                  <!--
                  <%= link_to "#", class:"btn btn-outline-warning" do %>
                    <i class="bi bi-heart-fill"></i>
                  <% end %>
                  -->
                <% end %>
              </div>
            </div>
            <hr class="border border-primary border-2 my-1">
            <!-- タイトル -->
            <p class="fw-bold my-0 mx-2 p-0">
              <%= review.title %>
            </p>
            <!-- 評価 -->
            <p class="my-0 mx-2 p-0">
              <%= review.rating %>
            </p>
          </div>
        <% end %>
      </div>

      <!-- ページネーション -->
      <div class="mt-3">
        <%= paginate @reviews, theme: "bootstrap-5", params: { anchor: "show-review-title" } %>
      </div>
    </div>
  <% end %>
</div>